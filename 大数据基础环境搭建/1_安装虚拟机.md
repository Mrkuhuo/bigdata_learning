
### 一、准备工作

1、安装一台 VMware 虚拟机，默认安装就行

下载地址：https://pan.baidu.com/s/1qN3ubIudMEyue2jpqZTmCg  提取码：1o22

vmwar秘钥：

5A02H-AU243-TZJ49-GTC7K-3C61N

VF5XA-FNDDJ-085GZ-4NXZ9-N20E6

UC5MR-8NE16-H81WY-R7QGV-QG2D8

ZG1WH-ATY96-H80QP-X7PEX-Y30V4

AA3E0-0VDE1-0893Z-KGZ59-QGAVF

centos镜像下载地址：https://pan.baidu.com/s/1psW7AVK30FJLFJfOVBozGA 提取码 u19z

2、在电脑磁盘内新建一个文件夹用来存放虚拟机

3、复制新建文件夹的路径备用

### 二、具体步骤

**（一）新建虚拟机**

1. 打开VirtualBox，点击“创建新的虚拟机”，勾选“自定义（高级）（C）”，并点击“下一步”

![](../images/img.png)

![](../images/img_1.png)

2. 选择硬件兼容性（H）Workstation 12.0，点击“下一步”，选择安装程序光盘映像文件(iso)(M)，点击“选择”按钮，选择到我已经给到链接的centos镜像文件，点击下一步。

![](../images/img_2.png)

![](../images/img_3.png)

![](../images/img_4.png)

3. 设置路径为 **存放虚拟机的路径** ，建议将虚拟机的名字改为自己熟悉的名字，继续点击 **下一步** 。处理器和内核数量根据自己需要进行设置。

![](../images/img_5.png)

![](../images/img_6.png)

4. 对虚拟机进行内存设置，建议根据自己的 **电脑运行内存** 进行设置，继续点击下一步，16G内存的推荐选择4G，8G内存的推荐选择2G。

![](../images/img_7.png)

5. 对虚拟机进行网络类型设置，选择使用网络地址转换(NAT)(E)，继续点击”下一步”，后续设置均按照默认安装进行，如果是初次安装，建议选择 **创建新虚拟机磁盘**。

![](../images/img_8.png)

![](../images/img_9.png)

![](../images/img_10.png)

![](../images/img_11.png)

6. 在设置磁盘大小时，根据自己需要进行设置，**如果是单机的话，建议设置的大一点** ，并勾选 **将虚拟机磁盘存储为单个文件** ，后续设置均按照默认安装进行。对硬件进行设置，点击 **自定义硬件**。

![](../images/img_12.png)

![](../images/img_13.png)

![](../images/img_14.png)

7. 建议对硬件进行删减，删除声卡和打印机，对光驱进行设置，此镜像文件链接里都有，配置完成后点击 **关闭** ，回到图11界面，点击 **完成** 。

![](../images/img_15.png)

![](../images/img_16.png)

8. 待界面转跳完毕后，点击 **开启此虚拟机**。

**（二）设置虚拟机**

1. 当启动虚拟机后鼠标指针会消失，利用键盘 **上下左右键** 进行操作，将 **白色** 上移到 **Install CentOS 7**，并按下 **回车键**（如图14）。待虚拟机安装完毕后，对虚拟机进行设置，**建议使用英文** ，并进行下一步安装。

![](../images/img_17.png)

![](../images/img_18.png)

![](../images/img_19.png)

2. 根据需要对时区进行设置，在Regions中选择Asia，在City中选择Shanghai，设置完后点击两次左上角 **DONE** 。

![](../images/img_20.png)

![](../images/img_21.png)

3. 对磁盘和网络进行设置，磁盘选择如图，点击40GB图标，双击左上角Done，完成磁盘配置，**一定要打开网络开关**。右上角将off点击切换成on。

![](../images/img_22.png)

![](../images/img_23.png)

![](../images/img_24.png)

![](../images/img_25.png)

4. 待上述设置完毕后点击 **Begin Installaction**。

![](../images/img_26.png)

5. 等待安装之际，把两个账户设置一下（其中普通用户可不设置），待页面跳转后点击 **Reboot** 。

![](../images/img_27.png)

![](../images/img_28.png)

**（三）配置虚拟机**

1. 输入上面设置的**用户名和密码** ，敲击 **回车键**，成功登录。

![](../images/img_29.png)

2. 对虚拟机的名字进行设置，**建议和创建虚拟机时的用户名一样** ，输入命令：**hostnamectl set-hostname hadoop001**（你想设置的主机名）。

![](../images/img_30.png)

3. 输入命令：`vi /etc/sysconfig/network-scripts/ifcfg-ens33`，进入页面进行设置。点击 i 或者 o 对命令行进行编辑，，配置完毕后点击 ESC 键，退回到 命令行模式 ，再输入命令： :x，保存并退出。

```
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
UUID=78edfbe7-9eec-4ecc-a454-c99a40deb4d1
DEVICE=ens33
ONBOOT=yes
IPADDR=192.168.16.129
NETMASK=255.255.255.0
GATEWAY=192.168.16.2
DNS1=8.8.8.8
DNS2=114.114.114.114
```
![](../images/img_31.png)

**IP地址设置应在什么范围内**？ 在Vmware Workstation界面，左上角点击“编辑”按钮，点击虚拟网络编辑器，选择到NET模式，点击“DHCP（设置）”按钮，查看起始ip地址，然后按上图进行修改。

![](../images/img_32.png)

![](../images/img_33.png)

![](../images/img_34.png)

4. 保存并退出之后，输入命令：`systemctl restart network`，重启网络服务。

![](../images/img_35.png)

5. 输入命令：`systemctl status firewalld`，查看防火墙状态。输入命令：`systemctl stop firewalld`、`systemctl disable firewalld`，来关闭并禁用防火墙。

![](../images/img_36.png)

![](../images/img_37.png)

![](../images/img_38.png)

6. 输入命令：ping www.baidu.com ，来测试外网是否通了，注意是否连接互联网，出现图上箭头所示的相关内容则表示外网是通的，按 ctrl+c 退出检测模式。在 Windows 环境下打开 cmd 输入命令：ping XXX.XXX.XXX.XXX（你虚拟机设置的IP地址），来测试内网是否通了出现图上箭头所示的相关内容则表示外网是通的。

![](../images/img_39.png)

![](../images/img_40.png)

**（三）NetworkManager 优化**

1. 输入命令：systemctl stop NetworkManager、systemctl disable NetworkManager、systemctl status NetworkManager，来关闭、禁用、查看网络管理状态，此操作是为了下次再起虚拟机时网络管理发生冲突，导致网络不通等问题。

![](../images/img_41.png)

**（四）将虚拟机链接至xshell** 

1. 保存新建的虚拟机时开启的状态，打开Xshell操作。

![](../images/img_42.png)

![](../images/img_43.png)

![](../images/img_44.png)

### 三、优化Xshell连接至虚拟机的速度

输入命令：vi /etc/ssh/sshd_config，进入文件编辑，在命令行模式下输入命令：/UseDNS，进入编辑模式，将 # 删除，将 yes 改成 no，退出并保存。输入命令：systemctl restart sshd，重启该服务。设置完毕后，可通过重新打开Xshell连接至虚拟机来感受一下连接速度。

### 四、复制虚拟机

1.   关闭虚拟机，右键虚拟机，再点击管理，点击克隆，下一步，最后点击完成。

![](../images/img_45.png)

![](../images/img_46.png)

![](../images/img_47.png)

![](../images/img_48.png)

![](../images/img_49.png)

2.  按以上步骤重复再复制一个虚拟机。

3.  按照步骤二修改hostname和ip，我这里设置成了192.168.16.129和192.168.16.130。

4.  使用xshell链接到hadoop002和hadoop003。

![](../images/img_50.png)